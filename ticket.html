async function checkGuest() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  const resultEl = document.getElementById("result");

  if (!id) {
    resultEl.innerHTML = "<div class='not-found'>ID mancante.</div>";
    return;
  }

  const [nome, cognome] = id.split("-");
  const url = `https://script.google.com/macros/s/AKfycbwRt2ivnC3yTJTjL3PsKjY6VTGhDsnRr5ADYuZ9ZfOXx3OlhShsVtSoyCoI6qFOUy8t/exec?nome=${nome}&cognome=${cognome}`;

  try {
    const response = await fetch(url);
    const data = await response.json();

    if (data.presente) {
      resultEl.innerHTML = `
        <div class="subtitle">Invito</div>
        <div class="line"><strong>${capitalize(id)}</strong>, grazie per la partecipazione.</div>
        <div class="line">✅ Sei stato aggiunto alla lista.</div>
        <div class="emphasis">La prima vera festa</div>
        <div class="line">sabato 10 maggio ore 20,30</div>
        <div class="line">Imola, via Codrignano 58p (3° km dalla Curva della Tosa)</div>
        <img class="location" src="poolArzella.jpg" alt="Foto location">
      `;
    } else {
      resultEl.innerHTML = `
        <div class="subtitle">Invito</div>
        <div class="not-found">Salve, se hai effettuato il pagamento riceverai presto un link con il tuo invito.</div>
      `;
    }
  } catch (err) {
    resultEl.innerHTML = `
      <div class="subtitle">Invito</div>
      <div class="not-found">⚠️ Errore nel recupero dei dati. Riprova più tardi.</div>
    `;
  }
}
